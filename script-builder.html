<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×•× ×” ×ª×¡×¨×™×˜×™× - ××” ×§×•×¨×” ×¤×”?!</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 15px 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 12px;
            opacity: 0.9;
            margin: 2px 0;
        }
        
        .main-content {
            display: flex;
            min-height: calc(100vh - 200px);
        }
        
        /* ×¡×™×“×‘×¨ ×©×××œ×™ - ×××’×¨ ×¡×¨×˜×•× ×™× */
        .sidebar {
            width: 350px;
            background: #f8f9fa;
            border-left: 2px solid #e9ecef;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }
        
        .sidebar-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .sidebar-header h3 {
            font-size: 1.1em;
            margin-bottom: 8px;
        }
        
        /* ××–×•×¨ ×¢×‘×•×“×” ××¨×›×–×™ */
        .workspace {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }
        
        .script-header {
            margin-bottom: 20px;
            padding: 12px;
            background: #e3f2fd;
            border-radius: 8px;
            border: 2px solid #bbdefb;
        }
        
        .script-header h3 {
            margin: 0 0 8px 0;
            font-size: 1em;
        }
        
        .script-header-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .script-header input {
            flex: 1;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
        }
        
        /* ×§×˜×¢ ××ª×§×¤×œ - ×¤×ª×™×—×” */
        .collapsible-section {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .collapsible-header {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            padding: 12px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .collapsible-header h3 {
            margin: 0;
            font-size: 1.2em;
        }
        
        .collapse-arrow {
            transition: transform 0.3s ease;
            font-size: 20px;
        }
        
        .collapsible-section.collapsed .collapse-arrow {
            transform: rotate(-90deg);
        }
        
        .collapsible-content {
            padding: 20px;
            max-height: 2000px;
            transition: max-height 0.5s ease, padding 0.5s ease;
            overflow: hidden;
        }
        
        .collapsible-section.collapsed .collapsible-content {
            max-height: 0;
            padding: 0 20px;
        }
        
        /* ×‘×—×™×¨×ª ××ª××•×“×“×™× */
        .contestants-selection {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .contestants-selection h4 {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .contestant-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .contestant-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .contestant-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .contestant-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-left: 10px;
            cursor: pointer;
        }
        
        .contestant-checkbox label {
            font-weight: bold;
            cursor: pointer;
            flex: 1;
        }
        
        .contestant-text {
            display: none;
            margin-top: 10px;
        }
        
        .contestant-item.selected .contestant-text {
            display: block;
        }
        
        .contestant-text textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            min-height: 60px;
        }
        
        /* ×§×˜×¢ ×‘×ª×¡×¨×™×˜ (×§×‘×•×¢) */
        .script-section {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .script-section.fixed-section {
            border-color: #bbdefb;
            background: #f0f8ff;
        }
        
        .section-header {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            padding: 12px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-header.round-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            cursor: move;
        }
        
        .section-header h4 {
            margin: 0;
            font-size: 1.1em;
        }
        
        .section-content {
            padding: 15px;
            display: none;
        }
        
        .script-section.active .section-content {
            display: block;
        }
        
        /* ×ª×™×‘×ª ×˜×§×¡×˜ ×¢×¨×™×›×” */
        .editable-text {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            min-height: 60px;
        }
        
        .editable-text:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        /* ××–×•×¨ ×”×•×¡×¤×ª ×¡×™×‘×•×‘ */
        .add-round-area {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #f0f8ff;
            border: 2px dashed #2196F3;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .add-round-area:hover {
            background: #e3f2fd;
            border-color: #1976D2;
        }
        
        /* ×¡×™×‘×•×‘×™× */
        .round {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        /* ×× ×™××¦×™×™×ª ×’×¨×™×¨×ª ×¡×™×‘×•×‘ */
        .round.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }
        
        .round.drag-over {
            border-top: 4px solid #667eea;
            margin-top: 10px;
        }
        
        /* ×× ×™×¢×ª blur ×¢×œ ×¡×™×‘×•×‘×™× ×¤×¢×™×œ×™× */
        .round.active {
            opacity: 1 !important;
            filter: none !important;
        }
        
        /* ×”×ª×—×œ×ª ××¦×‘ × ×§×™ ×œdropzones */
        .question-dropzone:not(.drag-over) {
            opacity: 0;
            pointer-events: none;
            max-height: 0;
            margin: 0;
        }
        
        .round-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }
        
        .round-header h4 {
            margin: 0;
            font-size: 1.1em;
        }
        
        .round-content {
            padding: 15px;
            display: none;
        }
        
        .round.active .round-content {
            display: block;
        }
        
        /* ×©××œ×•×ª ×‘×ª×•×š ×¡×™×‘×•×‘ */
        .questions-list {
            position: relative;
        }
        
        /* ××œ×× ×˜ ×©××œ×” ×¢× ×× ×™××¦×™×™×ª ×›× ×™×¡×” */
        @keyframes slideInFade {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .question-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            position: relative;
            cursor: move;
            transition: all 0.3s ease;
            animation: slideInFade 0.4s ease-out;
        }
        
        .question-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .question-item.dragging {
            opacity: 0.3;
            transform: scale(0.9);
        }
        
        /* ××™× ×“×™×§×˜×•×¨ ×œ××™×§×•× ×—×“×© ×‘×–××Ÿ ×’×¨×™×¨×” */
        .question-item.drag-preview {
            border: 2px dashed #28a745;
            background: rgba(40, 167, 69, 0.1);
            opacity: 0.6;
        }
        
        /* ××–×•×¨ ×’×¨×™×¨×” - ××•×¡×ª×¨ ×›×‘×¨×™×¨×ª ××—×“×œ */
        .question-dropzone {
            height: 60px;
            border: 2px dashed #28a745;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #28a745;
            font-weight: bold;
            margin: 10px 0;
            transition: all 0.3s ease;
            opacity: 0;
            pointer-events: none;
            max-height: 0;
            margin: 0;
            overflow: hidden;
        }
        
        /* ×”×¦×’×ª dropzones ×¨×§ ×‘×–××Ÿ ×’×¨×™×¨×” */
        body.dragging .question-dropzone {
            opacity: 1;
            pointer-events: all;
            max-height: 60px;
            margin: 10px 0;
        }
        
        /* ×•×™×“×•× ×©××œ×× ×˜×™× ×œ× × ×ª×§×¢×™× ×‘××¦×‘ dragging */
        body:not(.dragging) .dragging {
            opacity: 1 !important;
            transform: none !important;
        }
        
        .question-dropzone.drag-over {
            background: linear-gradient(45deg, #e8f5e9 25%, #f1f8e9 25%, #f1f8e9 50%, #e8f5e9 50%, #e8f5e9 75%, #f1f8e9 75%, #f1f8e9);
            background-size: 20px 20px;
            animation: move 0.5s linear infinite;
            border-color: #4caf50;
            transform: scale(1.02);
        }
        
        @keyframes move {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 20px 20px;
            }
        }
        
        .question-number {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 11px;
            margin-left: 10px;
        }
        
        /* ×›×¤×ª×•×¨×™× */
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #ff9800);
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        /* ×›×¨×˜×™×¡×™ ×¡×¨×˜×•× ×™× ×‘×××’×¨ */
        .video-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: grab;
            transition: all 0.3s ease;
        }
        
        .video-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }
        
        .video-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
            transform: scale(0.95);
        }
        
        .video-card.not-approved {
            opacity: 0.5;
            border: 2px dashed #dc3545;
        }
        
        .video-card.pending {
            border: 2px dashed #ffc107;
        }
        
        .video-card.used {
            background: #f0f0f0;
            opacity: 0.6;
            position: relative;
        }
        
        .video-card.used::after {
            content: 'âœ“ ×‘×©×™××•×©';
            position: absolute;
            top: 5px;
            left: 5px;
            background: #28a745;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }
        
        .video-card h5 {
            font-size: 13px;
            margin-bottom: 4px;
            color: #2c3e50;
        }
        
        .video-card .category {
            display: inline-block;
            background: #e3f2fd;
            color: #1565c0;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            margin-left: 5px;
        }
        
        .video-card .program {
            display: inline-block;
            background: #f3e5f5;
            color: #7b1fa2;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
        }
        
        .video-card .approval-status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .video-card .approval-status.approved {
            background: #d4edda;
            color: #155724;
        }
        
        .video-card .approval-status.not-approved {
            background: #f8d7da;
            color: #721c24;
        }
        
        .video-card .approval-status.pending {
            background: #fff3cd;
            color: #856404;
        }
        
        /* ×¤×™×œ×˜×¨×™× ×‘×××’×¨ */
        .filter-section {
            padding: 10px;
            background: white;
            border-bottom: 1px solid #e9ecef;
        }
        
        .filter-section input, .filter-section select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 8px;
        }
        
        /* ××–×•×¨ ×™×™×‘×•× ×•×™×™×¦×•× */
        .import-export {
            padding: 15px;
            background: #f8f9fa;
            border-top: 2px solid #e9ecef;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        /* ××•×“××œ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        
        /* ×ª×¦×•×’×ª ×ª×¡×¨×™×˜ */
        .script-preview {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
        }
        
        /* ×¨×©×™××ª ×ª×¡×¨×™×˜×™× ×©××•×¨×™× */
        .saved-scripts-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .saved-script-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .saved-script-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .saved-script-info h4 {
            margin: 0 0 5px 0;
            font-size: 14px;
        }
        
        .saved-script-info small {
            color: #666;
        }
        
        .saved-script-actions {
            display: flex;
            gap: 5px;
        }
        
        /* ×˜×¢×™× ×” */
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        /* ×”×•×“×¢×•×ª */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 2000;
            display: none;
        }
        
        .notification.show {
            display: block;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }
        
        /* ××¡×¤×¨ ××•×˜×•××˜×™ */
        .auto-number {
            background: #6c757d;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        /* ××¡×¤×¨ ×¡×™×‘×•×‘ */
        .round-number {
            background: #28a745;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: bold;
            margin-left: 8px;
        }
        
        /* ×¨×¡×¤×•× ×¡×™×‘ */
        @media (max-width: 1200px) {
            .sidebar {
                width: 300px;
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                max-height: 300px;
                border-left: none;
                border-bottom: 2px solid #e9ecef;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="notification" id="notification"></div>
        
        <div class="header">
            <h1>ğŸ¬ ×‘×•× ×” ×ª×¡×¨×™×˜×™× - ××” ×§×•×¨×” ×¤×”?!</h1>
            <p>×¦×•×¨ ×ª×¡×¨×™×˜ ××•×©×œ× ×¢× ×’×¨×™×¨×ª ×¡×¨×˜×•× ×™× ×™×©×™×¨×•×ª ××”×××’×¨</p>
        </div>
        
        <div class="main-content">
            <!-- ×¡×™×“×‘×¨ - ×××’×¨ ×¡×¨×˜×•× ×™× -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <h3>ğŸ“¦ ×××’×¨ ×¡×¨×˜×•× ×™×</h3>
                    <button class="btn btn-success btn-sm" onclick="refreshVideos()">ğŸ”„ ×¨×¢× ×Ÿ</button>
                </div>
                
                <div class="filter-section">
                    <input type="text" id="searchVideos" placeholder="ğŸ” ×—×¤×© ×¡×¨×˜×•×Ÿ..." onkeyup="filterVideos()">
                    <select id="categoryFilter" onchange="filterVideos()">
                        <option value="">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>
                    </select>
                    <select id="programFilter" onchange="filterVideos()">
                        <option value="">×›×œ ×”×ª×•×›× ×™×•×ª</option>
                        <option value="unassigned">×œ× ×©×•×‘×¥</option>
                        <option value="1">×¤×¨×§ 1</option>
                        <option value="2">×¤×¨×§ 2</option>
                        <option value="3">×¤×¨×§ 3</option>
                        <option value="4">×¤×¨×§ 4</option>
                        <option value="5">×¤×¨×§ 5</option>
                    </select>
                    <select id="approvalFilter" onchange="filterVideos()">
                        <option value="">×›×œ ×”×¡×˜×˜×•×¡×™×</option>
                        <option value="approved">×××•×©×¨</option>
                        <option value="not-approved">×œ× ×××•×©×¨</option>
                        <option value="pending">×‘×˜×™×¤×•×œ</option>
                    </select>
                </div>
                
                <div id="videoList" class="video-list">
                    <div class="loading">×˜×•×¢×Ÿ ×¡×¨×˜×•× ×™× ××”×××’×¨...</div>
                </div>
            </div>
            
            <!-- ××–×•×¨ ×¢×‘×•×“×” -->
            <div class="workspace">
                <div class="script-header">
                    <h3>ğŸ“‹ ×¤×¨×˜×™ ×”×ª×•×›× ×™×ª</h3>
                    <div class="script-header-inputs">
                        <input type="text" id="programNumber" placeholder="×ª×•×›× ×™×ª ××¡×³">
                        <input type="text" id="programDate" placeholder="×ª××¨×™×š">
                        <input type="text" id="draftNumber" placeholder="×“×¨××¤×˜ ××¡×³">
                    </div>
                </div>
                
                <!-- ×—×œ×§ ×”×¤×ª×™×—×” ×”××ª×§×¤×œ -->
                <div class="collapsible-section collapsed" id="openingSection">
                    <div class="collapsible-header" onclick="toggleCollapsible('openingSection')">
                        <h3>ğŸ¬ ×—×œ×§ ×”×¤×ª×™×—×”</h3>
                        <span class="collapse-arrow">â–¼</span>
                    </div>
                    <div class="collapsible-content" id="openingContent">
                        <!-- ×›××Ÿ ×™×•×•×¦×¨×• ×—×œ×§×™ ×”×¤×ª×™×—×” -->
                    </div>
                </div>
                
                <div class="script-container" id="scriptContainer">
                    <!-- ×›××Ÿ ×™×•×•×¦×¨×• ×”×¡×™×‘×•×‘×™× -->
                </div>
                
                <!-- ××–×•×¨ ×”×•×¡×¤×ª ×¡×™×‘×•×‘ -->
                <div class="add-round-area">
                    <button class="btn btn-success" onclick="addNewRound()">â• ×”×•×¡×£ ×¡×™×‘×•×‘ ×—×“×©</button>
                    <p style="margin-top: 10px; color: #666; font-size: 12px;">×’×¨×•×¨ ×¡×¨×˜×•× ×™× ××”×××’×¨ ×œ×ª×•×š ×”×¡×™×‘×•×‘×™×</p>
                </div>
                
                <!-- ×“×‘×¨×™ ×¡×™×•× ×™×•×•×¦×¨×• ×›××Ÿ -->
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-warning" onclick="previewScript()">ğŸ‘ï¸ ×ª×¦×•×’×” ××§×“×™××”</button>
                    <button class="btn btn-primary" onclick="exportScript()">ğŸ“ ×™×™×¦× ×˜×§×¡×˜</button>
                    <button class="btn btn-primary" style="background: linear-gradient(135deg, #2b579a, #1d4084);" onclick="exportToWord()">ğŸ“„ ×™×™×¦× ×œ×•×•×¨×“</button>
                    <button class="btn btn-success" style="background: linear-gradient(135deg, #207245, #0f5132);" onclick="exportVideosTable()">ğŸ“Š ×™×™×¦× ×˜×‘×œ×ª ×¡×¨×˜×•× ×™×</button>
                </div>
            </div>
        </div>
        
        <div class="import-export">
            <button class="btn btn-primary" onclick="saveToFirebase()">â˜ï¸ ×©××•×¨ ×‘×¢× ×Ÿ</button>
            <button class="btn btn-success" onclick="showSavedScripts()">ğŸ“‚ ×˜×¢×Ÿ ××”×¢× ×Ÿ</button>
            <button class="btn btn-primary" onclick="saveProject()">ğŸ’¾ ×”×•×¨×“ ×’×™×‘×•×™</button>
            <button class="btn btn-success" onclick="loadProject()">ğŸ“ ×˜×¢×Ÿ ××§×•×‘×¥</button>
        </div>
    </div>
    
    <!-- ××•×“××œ ×ª×¦×•×’×” ××§×“×™××” -->
    <div class="modal" id="previewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>×ª×¦×•×’×” ××§×“×™××”</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="script-preview" id="scriptPreview"></div>
            </div>
        </div>
    </div>
    
    <!-- ××•×“××œ ×ª×¡×¨×™×˜×™× ×©××•×¨×™× -->
    <div class="modal" id="savedScriptsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>×ª×¡×¨×™×˜×™× ×©××•×¨×™×</h3>
                <button class="modal-close" onclick="closeSavedScriptsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="saved-scripts-list" id="savedScriptsList">
                    <div class="loading">×˜×•×¢×Ÿ ×ª×¡×¨×™×˜×™×...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <script>
        // ×”×’×“×¨×•×ª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyA_xIrjXqNBHtvCdruFeinIN4G134GqPiI",
            authDomain: "makorepo-81e68.firebaseapp.com",
            databaseURL: "https://makorepo-81e68-default-rtdb.firebaseio.com",
            projectId: "makorepo-81e68",
            storageBucket: "makorepo-81e68.firebasestorage.app",
            messagingSenderId: "25343223097",
            appId: "1:25343223097:web:3f4c38f1802ad0a9a5b4e8",
            measurementId: "G-EWC51ELEXS"
        };

        // ××ª×—×•×œ Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const videosRef = database.ref('videos');
        const scriptsRef = database.ref('scripts'); // × ×ª×™×‘ ×—×“×© ×œ×ª×¡×¨×™×˜×™×
        
        // ××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
        let videoDatabase = [];
        let usedVideos = new Set(); // ×¨×©×™××ª ×”×¡×¨×˜×•× ×™× ×‘×©×™××•×©
        let currentProject = {
            programNumber: '',
            programDate: '',
            draftNumber: '',
            sections: []
        };
        let sectionCounter = 1;
        let roundCounter = 0;
        
        // ×¨×©×™××ª ×”××ª××•×“×“×™×
        const contestants = [
            { id: 'giora', name: '×’×™×•×¨× ×–×™× ×’×¨' },
            { id: 'matan', name: '××ª×Ÿ ×¤×¨×¥' },
            { id: 'mirit', name: '××™×¨×™×ª ××•×’×–××ª ×œ×™×‘×¦×§×™' },
            { id: 'uri', name: '××•×¨×™ ×‘×¨×•×™×¨' },
            { id: 'linor', name: '×œ×™× ×•×¨ ××‘×¨×’\'×™×œ' },
            { id: 'shachar', name: '×©×—×¨ ×§×¤×œ×Ÿ' },
            { id: 'tal', name: '×˜×œ ×¨××©×•×Ÿ' },
            { id: 'nofar', name: '× ×•×¤×¨ ×¡×•×•×™×¡×”' }
        ];
        
        // ××‘× ×” ×”×ª×¡×¨×™×˜ ×”×§×‘×•×¢ ×”××¢×•×“×›×Ÿ
        const templateSections = [
            {
                id: 'pre-opening',
                type: 'fixed',
                number: 1,
                title: '×¤×¨×” ×¤×ª×™×— - ×œ× ×¦×¨×™×š ××©×•×˜ ×¨×—×£, ××œ× ×¡×’×•×¨ ×©×œ×•×',
                content: `×¢×¨×‘ ×˜×•×‘, ×× ×—× ×• ×›××Ÿ ×‘×ª×›× ×™×ª ×—×“×©×”, ×©×ª×¢×–×•×¨ ×œ×›× ×œ×§×—×ª ×”×¤×•×’×” ×§×œ×” ××¨×¦×£ ×©×™×“×•×¨×™ ×”×—×“×©×•×ª. ×× ×—× ×• ××××™× ×™× ×©×”×•××•×¨ ×™×›×•×œ ×œ×”×§×œ ×•×œ×—×–×§, ×•××ª ×–×” ×× ×—× ×• ×™×•×“×¢×™× ×œ×¢×©×•×ª ×™×•×ª×¨ ×˜×•×‘ ××›×œ ×¢× ×‘×¢×•×œ×. ×‘××§×¨×” ×•×™×™×“×¨×©, ×›××•×‘×Ÿ ×©× ×¢×“×›×Ÿ ××ª×›× ×‘×›×œ ×”×ª×¨×—×©×•×ª. ××– ×”×¦×˜×¨×¤×• ××œ×™× ×• ×œ×©×¢×” ×§×œ×™×œ×”, ×›×™ ×× ×›×‘×¨ × ×›× ×¡× ×• ×œ×××“, ×‘×•××• × ×¦×—×§ ×‘×™×—×“ - ×›×™ ××ª ×–×” ××£ ×¤×¨×¡×™ ×œ× ×™×›×•×œ ×œ×§×—×ª ×××ª× ×•! ×‘×•××• × ×ª×—×™×œ:`
            },
            {
                id: 'opening',
                type: 'fixed',
                number: 2,
                title: '×¤×ª×™×— ×•×©×•×˜ ×¤×ª×™×—×”',
                content: ''
            },
            {
                id: 'opening-words',
                type: 'fixed',
                number: 3,
                title: '×“×‘×¨×™ ×¤×ª×™×—×” - ×©×œ×•× ××¡×™×™×’:',
                content: `×¢×¨×‘ ×˜×•×‘ ×•×‘×¨×•×›×™× ×”×‘××™× ×œ×ª×•×›× ×™×ª [××¡×¤×¨] ×©×œ "××” ×§×•×¨×” ×¤×”?!" - ×”×ª×•×›× ×™×ª ×©×©××” ×‘×¦×“ ××ª ×”×“×‘×¨×™× ×”×—×©×•×‘×™× ×‘×××ª ×•×¦×•×—×§×ª ×¢×œ ×›×œ ×”×“×‘×¨×™× ×”×§×˜× ×™× ×•×”××©×•×’×¢×™× ×©×§×•×¨×™× ×¡×‘×™×‘× ×•!`
            },
            {
                id: 'intro-contestants',
                type: 'fixed',
                number: 4,
                title: '×”×›×¨×•×ª ×¢× ×”××ª××•×“×“×™×',
                content: `×¨×’×¢ ×œ×¤× ×™ ×©××¡×‘×™×¨ ×œ×›× ××ª ×—×•×§×™ ×”××©×—×§ ×©×œ× ×•, ×‘×•××• × ×›×™×¨ ××ª ×”×§×•××™×§××™× ×©×™×”×™×• ××ª× ×• ×”×¢×¨×‘ ×•×™×¢×©×• ×œ× ×• ×§×¦×ª ×˜×•×‘ ×¢×œ ×”×œ×‘!`
            },
            {
                id: 'contestants-selection',
                type: 'contestants',
                number: 5,
                title: '×‘×—×™×¨×ª ××ª××•×“×“×™×',
                content: ''
            },
            {
                id: 'game-explanation',
                type: 'fixed',
                number: 6,
                title: '×”×¡×‘×¨ ×¢×œ ×”××©×—×§',
                content: `××– ××” ×™×™×§×¨×” ×¤×” ×”×¢×¨×‘ ×•××™×š ×”××©×—×§ ×©×œ× ×• ×”×•×œ×š?

×× ×™ ××¨××” ×œ×—××©×ª ×”×× ×©×™× ×”××¦×—×™×§×™× ×©×™×•×©×‘×™× ×¤×”, ×¨×’×¢×™× ×§×¦×¨×™× ××ª×•×š ×“×‘×¨×™× ×©×¨××™× ×• ×œ××—×¨×•× ×” ×‘×˜×œ×•×•×™×–×™×” ×•×‘×¨×©×ª, ×•××©××œ ××•×ª× ×©××œ×” ×¢×œ ×”××©×š ×”×§×˜×¢ - ×”× ×™×¦×˜×¨×›×• ×œ× ×—×© ××” ×§×•×¨×” ×¤×”!

××™ ×©×™×§×‘×œ ×”×›×™ ×”×¨×‘×” × ×§×•×“×•×ª ×¢×“ ×¡×•×£ ×”××©×—×§ ×™×•×›×¨×– ×›×× ×¦×— ×”×ª×•×›× ×™×ª ×•×™×–×›×” ×‘×©×œ×œ ×™×¦×™×¨×•×ª ×©×œ ×”×‘×Ÿ ×©×œ×™ ××”×’×Ÿ.

×”×¨××©×•×Ÿ ××• ×”×¨××©×•× ×” ×©×™×™×œ×—×¦×• ×¢×œ ×”×‘××–×¨ ×•×™×¢× ×• ×ª×©×•×‘×” × ×›×•× ×” - ×™×™×–×›×• ×‘- 10 × ×§×•×“×•×ª. ×—×©×•×‘ ×œ×”×’×™×“ - ×œ×™ ×™×© ××ª ×”×–×›×•×ª ×œ×ª×ª × ×§×•×“×•×ª ×‘×•× ×•×¡ ×¢×œ ×ª×©×•×‘×•×ª ×©××”×‘×ª×™ ×‘××™×•×—×“.

××– ×ª×–×›×¨×•, ×‘×ª×•×›× ×™×ª ×©×œ× ×•, ×›××• ×‘×›×‘×™×©, ×—×©×•×‘ ×œ×”×™×•×ª ×¦×•×“×§, ××‘×œ ×™×•×ª×¨ ×—×©×•×‘ ×œ× ×œ×ª×ª ×œ××£ ××—×“ ×œ×¢×§×•×£ ××ª×›×!

×× ×™ ××¨×’×™×© ×©××ª× ×œ× ×¨×’×•×¢×™×, ××– ×œ×¤× ×™ ×©× ×¦×˜×¨×š ×œ×—×œ×§ ×œ×›× ×¨×˜×œ×™×Ÿ - ×× ×™ ××¦×™×¢ ×©× ×ª×—×™×œ.`
            },
            {
                id: 'closing-words',
                type: 'fixed',
                number: 999, // ××¡×¤×¨ ×’×‘×•×” ×›×“×™ ×©×ª××™×“ ×™×”×™×” ××—×¨×•×Ÿ
                title: '×“×‘×¨×™ ×¡×™×•×',
                content: `×–×”×• ×œ×”×™×•×. ××§×•×•×” ×©×¢×–×¨× ×• ×œ×›× ×œ×™×”× ×•×ª ×§×¦×ª ××”×©×™×’×¢×•×Ÿ.
×××—×œ ×œ×›×•×œ× ×• ×œ×™×œ×” ×‘×˜×•×— ×•×××Ÿ ×©×™×”×™×” ×’× ×©×§×˜ ×•×œ×›×œ ××™ ×©×œ× ××ª× ×• ×”×¢×¨×‘, ×©×™×—×–×¨×• ×›×‘×¨ ×”×‘×™×ª×” ×œ×¤×” ×•××”×¨.
× ×¤×’×© ×¤×” ×©×•×‘ ×‘×©×‘×•×¢ ×”×‘× ×•× × ×¡×” ×™×—×“ ×œ×¤×¦×— ××ª ×©××œ×ª ×”×©××œ×•×ª -- ××” ×§×•×¨×” ×¤×”!!!!
×œ×™×œ×” ×˜×•×‘.`
            }
        ];
        
        // ×¤×•× ×§×¦×™×” ×œ×”××¨×ª ×¡×˜×˜×•×¡ ××™×©×•×¨ ×œ×˜×§×¡×˜
        function getApprovalText(status) {
            switch(status) {
                case 'approved':
                    return '×××•×©×¨';
                case 'not-approved':
                    return '×œ× ×××•×©×¨';
                case 'pending':
                    return '×‘×˜×™×¤×•×œ';
                default:
                    return '×‘×˜×™×¤×•×œ';
            }
        }
        
        // ×¤×•× ×§×¦×™×” ×—×“×©×” ×œ×™×™×¦×•× ×˜×‘×œ×ª ×¡×¨×˜×•× ×™×
        function exportVideosTable() {
            try {
                showNotification('ğŸ“Š ×™×•×¦×¨ ×˜×‘×œ×ª ×¡×¨×˜×•× ×™×...');
                
                const programNum = document.getElementById('programNumber').value || '[××¡×¤×¨]';
                const programDate = document.getElementById('programDate').value || '[×ª××¨×™×š]';
                const draftNum = document.getElementById('draftNumber').value || '[××¡×¤×¨]';
                
                // ××™×¡×•×£ ×›×œ ×”×¡×¨×˜×•× ×™× ×œ×¤×™ ×¡×™×‘×•×‘×™×
                const roundsData = [];
                
                document.querySelectorAll('.round').forEach((round, index) => {
                    const roundNameInput = round.querySelector('.round-header input');
                    const roundName = roundNameInput ? roundNameInput.value : `×¡×™×‘×•×‘ ${index + 1}`;
                    
                    const videos = [];
                    round.querySelectorAll('.question-item:not(.question-dropzone)').forEach(question => {
                        if (question.dataset.videoData) {
                            const videoData = JSON.parse(question.dataset.videoData);
                            const questionInput = question.querySelector('input[placeholder="×”×›× ×¡ ×©××œ×”..."]');
                            
                            videos.push({
                                number: videoData.number || '',
                                title: videoData.title || '',
                                question: questionInput ? questionInput.value : (videoData.question || ''),
                                approvalStatus: videoData.approvalStatus || 'pending'
                            });
                        }
                    });
                    
                    if (videos.length > 0) {
                        roundsData.push({
                            name: roundName,
                            videos: videos
                        });
                    }
                });
                
                if (roundsData.length === 0) {
                    alert('××™×Ÿ ×¡×¨×˜×•× ×™× ×‘×ª×¡×¨×™×˜');
                    return;
                }
                
                // ×™×¦×™×¨×ª ×ª×•×›×Ÿ HTML ×œ×•×•×¨×“
                let wordContent = `
                <!DOCTYPE html>
                <html xmlns:o="urn:schemas-microsoft-com:office:office" 
                      xmlns:w="urn:schemas-microsoft-com:office:word" 
                      xmlns="http://www.w3.org/TR/REC-html40">
                <head>
                    <meta charset="UTF-8">
                    <meta name="ProgId" content="Word.Document">
                    <meta name="Generator" content="Microsoft Word">
                    <meta name="Originator" content="Microsoft Word">
                    <!--[if gte mso 9]>
                    <xml>
                    <w:WordDocument>
                    <w:View>Print</w:View>
                    <w:Zoom>100</w:Zoom>
                    <w:DoNotOptimizeForBrowser/>
                    </w:WordDocument>
                    </xml>
                    <![endif]-->
                    <style>
                        @page {
                            size: A4 portrait;
                            margin: 0.5in;
                        }
                        body { 
                            font-family: 'Calibri', 'Arial', sans-serif; 
                            font-size: 9pt; 
                            direction: rtl; 
                            text-align: right;
                            margin: 0.5in;
                            line-height: 1.2;
                        }
                        h1 { 
                            font-size: 14pt; 
                            font-weight: bold; 
                            text-align: center; 
                            margin-bottom: 10pt;
                            color: #2c3e50;
                        }
                        h2 { 
                            font-size: 10pt; 
                            font-weight: bold; 
                            margin-bottom: 8pt;
                            color: #34495e;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-bottom: 10pt;
                            font-size: 8pt;
                            table-layout: fixed;
                        }
                        th { 
                            background-color: #3498db; 
                            color: white; 
                            padding: 3pt 2pt; 
                            border: 0.5pt solid #2980b9; 
                            font-weight: bold;
                            text-align: center;
                            font-size: 8pt;
                            line-height: 1.1;
                        }
                        td { 
                            padding: 2pt 3pt; 
                            border: 0.5pt solid #bdc3c7; 
                            vertical-align: top;
                            line-height: 1.1;
                            word-wrap: break-word;
                        }
                        tr:nth-child(even) { 
                            background-color: #f8f9fa; 
                        }
                        .number { 
                            text-align: center; 
                            font-weight: bold;
                            width: 8%;
                        }
                        .title { 
                            font-weight: bold;
                            width: 37%;
                        }
                        .question { 
                            width: 40%;
                        }
                        .approval { 
                            text-align: center; 
                            font-weight: bold;
                            width: 15%;
                        }
                        .round-header {
                            background-color: #28a745;
                            color: white;
                            font-weight: bold;
                            padding: 4pt;
                            text-align: center;
                            font-size: 10pt;
                        }
                        .summary {
                            margin-top: 10pt;
                            padding: 6pt;
                            background-color: #ecf0f1;
                            border: 0.5pt solid #bdc3c7;
                            font-size: 8pt;
                            line-height: 1.3;
                        }
                    </style>
                </head>
                <body>`;
                
                // ×›×•×ª×¨×ª ×”××¡××š
                wordContent += `<h1>ğŸ¬ ×¨×©×™××ª ×¡×¨×˜×•× ×™× - ×ª×›× ×™×ª ${programNum}</h1>`;
                wordContent += `<h2>×ª××¨×™×š: ${programDate} | ×“×¨××¤×˜: ${draftNum}</h2>`;
                
                // ×ª××¨×™×š ×•×©×¢×ª ×™×¦×™×¨×”
                const now = new Date();
                wordContent += `<h2>× ×•×¦×¨ ×‘×ª××¨×™×š: ${now.toLocaleDateString('he-IL')} ×‘×©×¢×” ${now.toLocaleTimeString('he-IL')}</h2>`;
                
                let totalVideos = 0;
                
                // ×™×¦×™×¨×ª ×˜×‘×œ×” ×œ×›×œ ×¡×™×‘×•×‘
                roundsData.forEach((round, roundIndex) => {
                    wordContent += `<div class="round-header">×¡×™×‘×•×‘ ${roundIndex + 1} - ${round.name}</div>`;
                    
                    wordContent += `
                    <table>
                        <thead>
                            <tr>
                                <th class="number">××¡'</th>
                                <th class="title">×”×¡×¨×˜×•×Ÿ</th>
                                <th class="question">×©××œ×”</th>
                                <th class="approval">×¡×˜×˜×•×¡</th>
                            </tr>
                        </thead>
                        <tbody>`;
                    
                    round.videos.forEach((video, index) => {
                        wordContent += `
                        <tr>
                            <td class="number">${video.number || (index + 1)}</td>
                            <td class="title">${video.title}</td>
                            <td class="question">${video.question}</td>
                            <td class="approval">${getApprovalText(video.approvalStatus)}</td>
                        </tr>`;
                    });
                    
                    wordContent += `</tbody></table>`;
                    
                    totalVideos += round.videos.length;
                });
                
                // ×¡×™×›×•×
                wordContent += `
                <div class="summary">
                    <strong>×¡×™×›×•×:</strong><br>
                    ×¡×”"×› ×¡×™×‘×•×‘×™×: ${roundsData.length}<br>
                    ×¡×”"×› ×¡×¨×˜×•× ×™×: ${totalVideos}<br>`;
                
                // ×¤×™×¨×•×˜ ×œ×¤×™ ×¡×™×‘×•×‘×™×
                roundsData.forEach((round, index) => {
                    wordContent += `×¡×™×‘×•×‘ ${index + 1} - ${round.name}: ${round.videos.length} ×¡×¨×˜×•× ×™×<br>`;
                });
                
                wordContent += `<br>×ª××¨×™×š ×•×©×¢×ª ×™×™×¦×•×: ${new Date().toLocaleString('he-IL')}<br>
                    ××¢×¨×›×ª: ×‘×•× ×” ×ª×¡×¨×™×˜×™×
                </div>`;
                
                wordContent += `
                </body>
                </html>`;
                
                // ×™×¦×™×¨×ª ×”×§×•×‘×¥ ×•×”×•×¨×“×”
                const blob = new Blob([wordContent], {
                    type: 'application/msword;charset=utf-8'
                });
                
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `×˜×‘×œ×ª_×¡×¨×˜×•× ×™×_×ª×›× ×™×ª_${programNum}_×“×¨××¤×˜_${draftNum}.doc`;
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showNotification(`âœ… ×˜×‘×œ×ª ×”×¡×¨×˜×•× ×™× ×™×•×¦××” ×‘×”×¦×œ×—×”!`);
                
            } catch (error) {
                console.error('×©×’×™××” ×‘×™×™×¦×•× ×˜×‘×œ×ª ×¡×¨×˜×•× ×™×:', error);
                showNotification('âŒ ×©×’×™××” ×‘×™×™×¦×•× ×”×˜×‘×œ×”', 'error');
            }
        }
        
        // ×¤×•× ×§×¦×™×•×ª Firebase ×œ×ª×¡×¨×™×˜×™×
        async function saveToFirebase() {
            const scriptName = prompt('×ª×Ÿ ×©× ×œ×ª×¡×¨×™×˜ (×œ××©×œ: ×ª×›× ×™×ª 5 ×“×¨××¤×˜ 2)');
            if (!scriptName) return;
            
            try {
                const scriptData = buildProjectData();
                scriptData.name = scriptName;
                scriptData.createdAt = new Date().toISOString();
                scriptData.updatedAt = new Date().toISOString();
                
                // ×©××™×¨×” ×‘×¤×™×™×¨×‘×™×™×¡
                const newScriptRef = scriptsRef.push();
                await newScriptRef.set(scriptData);
                
                showNotification('âœ… ×”×ª×¡×¨×™×˜ × ×©××¨ ×‘×”×¦×œ×—×” ×‘×¢× ×Ÿ!');
            } catch (error) {
                console.error('×©×’×™××” ×‘×©××™×¨×”:', error);
                showNotification('âŒ ×©×’×™××” ×‘×©××™×¨×ª ×”×ª×¡×¨×™×˜', 'error');
            }
        }
        
        async function showSavedScripts() {
            document.getElementById('savedScriptsModal').style.display = 'flex';
            
            try {
                const snapshot = await scriptsRef.once('value');
                const scripts = snapshot.val();
                
                const scriptsList = document.getElementById('savedScriptsList');
                scriptsList.innerHTML = '';
                
                if (!scripts) {
                    scriptsList.innerHTML = '<div class="loading">××™×Ÿ ×ª×¡×¨×™×˜×™× ×©××•×¨×™×</div>';
                    return;
                }
                
                // ×”××¨×” ×œ××¢×¨×š ×•×¡×™×“×•×¨ ×œ×¤×™ ×ª××¨×™×š
                const scriptsArray = Object.entries(scripts).map(([id, script]) => ({
                    id,
                    ...script
                }));
                
                scriptsArray.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
                
                scriptsArray.forEach(script => {
                    const scriptItem = document.createElement('div');
                    scriptItem.className = 'saved-script-item';
                    
                    const createdDate = new Date(script.createdAt).toLocaleString('he-IL');
                    const updatedDate = new Date(script.updatedAt).toLocaleString('he-IL');
                    
                    scriptItem.innerHTML = `
                        <div class="saved-script-info">
                            <h4>${script.name}</h4>
                            <small>× ×•×¦×¨: ${createdDate}</small>
                            <br>
                            <small>×¢×•×“×›×Ÿ: ${updatedDate}</small>
                        </div>
                        <div class="saved-script-actions">
                            <button class="btn btn-primary btn-sm" onclick="loadFromFirebase('${script.id}')">×˜×¢×Ÿ</button>
                            <button class="btn btn-warning btn-sm" onclick="updateInFirebase('${script.id}')">×¢×“×›×Ÿ</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteFromFirebase('${script.id}')">××—×§</button>
                        </div>
                    `;
                    
                    scriptsList.appendChild(scriptItem);
                });
            } catch (error) {
                console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×¡×¨×™×˜×™×:', error);
                showNotification('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×ª×¡×¨×™×˜×™×', 'error');
            }
        }
        
        async function loadFromFirebase(scriptId) {
            try {
                const snapshot = await scriptsRef.child(scriptId).once('value');
                const scriptData = snapshot.val();
                
                if (!scriptData) {
                    showNotification('âŒ ×”×ª×¡×¨×™×˜ ×œ× × ××¦×', 'error');
                    return;
                }
                
                // ×˜×¢×™× ×ª ×”× ×ª×•× ×™×
                loadProjectData(scriptData);
                
                closeSavedScriptsModal();
                showNotification('âœ… ×”×ª×¡×¨×™×˜ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”!');
            } catch (error) {
                console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×¡×¨×™×˜:', error);
                showNotification('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×ª×¡×¨×™×˜', 'error');
            }
        }
        
        async function updateInFirebase(scriptId) {
            const confirmUpdate = confirm('×”×× ×œ×¢×“×›×Ÿ ××ª ×”×ª×¡×¨×™×˜ ×”×©××•×¨ ×¢× ×”× ×ª×•× ×™× ×”× ×•×›×—×™×™×?');
            if (!confirmUpdate) return;
            
            try {
                const scriptData = buildProjectData();
                scriptData.updatedAt = new Date().toISOString();
                
                // ×©××™×¨×ª ×”×©× ×”×§×™×™×
                const existingSnapshot = await scriptsRef.child(scriptId).once('value');
                const existingData = existingSnapshot.val();
                scriptData.name = existingData.name;
                scriptData.createdAt = existingData.createdAt;
                
                await scriptsRef.child(scriptId).set(scriptData);
                
                showNotification('âœ… ×”×ª×¡×¨×™×˜ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”!');
                closeSavedScriptsModal();
            } catch (error) {
                console.error('×©×’×™××” ×‘×¢×“×›×•×Ÿ:', error);
                showNotification('âŒ ×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×ª×¡×¨×™×˜', 'error');
            }
        }
        
        async function deleteFromFirebase(scriptId) {
            const confirmDelete = confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×ª×¡×¨×™×˜?');
            if (!confirmDelete) return;
            
            try {
                await scriptsRef.child(scriptId).remove();
                showNotification('âœ… ×”×ª×¡×¨×™×˜ × ××—×§ ×‘×”×¦×œ×—×”!');
                showSavedScripts(); // ×¨×¢× ×•×Ÿ ×”×¨×©×™××”
            } catch (error) {
                console.error('×©×’×™××” ×‘××—×™×§×”:', error);
                showNotification('âŒ ×©×’×™××” ×‘××—×™×§×ª ×”×ª×¡×¨×™×˜', 'error');
            }
        }
        
        function closeSavedScriptsModal() {
            document.getElementById('savedScriptsModal').style.display = 'none';
        }
        
        // ×¤×•× ×§×¦×™×” ×œ×‘× ×™×™×ª × ×ª×•× ×™ ×”×¤×¨×•×™×§×˜
        function buildProjectData() {
            const project = {
                programNumber: document.getElementById('programNumber').value,
                programDate: document.getElementById('programDate').value,
                draftNumber: document.getElementById('draftNumber').value,
                sections: []
            };
            
            // ×©××™×¨×ª ×¡×¢×™×¤×™ ×”×¤×ª×™×—×”
            document.querySelectorAll('#openingContent .script-section').forEach(section => {
                const sectionId = section.dataset.sectionId;
                
                if (sectionId === 'contestants-selection') {
                    // ×©××™×¨×ª ×‘×—×™×¨×ª ××ª××•×“×“×™×
                    const contestantsData = {};
                    contestants.forEach(contestant => {
                        const checkbox = document.getElementById(`check-${contestant.id}`);
                        const textarea = document.querySelector(`[data-contestant="${contestant.id}"]`);
                        contestantsData[contestant.id] = {
                            selected: checkbox ? checkbox.checked : false,
                            text: textarea ? textarea.value : ''
                        };
                    });
                    project.sections.push({
                        type: 'contestants',
                        data: contestantsData
                    });
                } else {
                    project.sections.push({
                        type: 'fixed',
                        id: sectionId,
                        content: section.querySelector('.editable-text')?.value || ''
                    });
                }
            });
            
            // ×©××™×¨×ª ×¡×™×‘×•×‘×™×
            document.querySelectorAll('.round').forEach(round => {
                const roundData = {
                    type: 'round',
                    name: round.querySelector('.round-header input').value,
                    intro: round.querySelector('.editable-text').value,
                    questions: []
                };
                
                round.querySelectorAll('.question-item:not(.question-dropzone)').forEach(question => {
                    if (question.dataset.videoData) {
                        const inputs = question.querySelectorAll('input');
                        roundData.questions.push({
                            videoData: JSON.parse(question.dataset.videoData),
                            question: inputs[0]?.value || '',
                            answer: inputs[1]?.value || '',
                            after: inputs[2]?.value || ''
                        });
                    }
                });
                
                project.sections.push(roundData);
            });
            
            // ×©××™×¨×ª ×“×‘×¨×™ ×¡×™×•×
            const closingSection = document.querySelector('[data-section-id="closing-words"]');
            if (closingSection) {
                project.sections.push({
                    type: 'fixed',
                    id: 'closing-words',
                    content: closingSection.querySelector('.editable-text').value
                });
            }
            
            return project;
        }
        
        // ×¤×•× ×§×¦×™×” ×œ×˜×¢×™× ×ª × ×ª×•× ×™ ×¤×¨×•×™×§×˜
        function loadProjectData(project) {
            // ×˜×¢×™× ×ª ×¤×¨×˜×™ ×”×ª×•×›× ×™×ª
            document.getElementById('programNumber').value = project.programNumber || '';
            document.getElementById('programDate').value = project.programDate || '';
            document.getElementById('draftNumber').value = project.draftNumber || '';
            
            // × ×™×§×•×™ ×•×˜×¢×™× ×” ××—×“×©
            initializeScript();
            document.getElementById('scriptContainer').innerHTML = '';
            
            const closingData = project.sections.find(s => s.id === 'closing-words');
            
            project.sections.forEach(section => {
                if (section.type === 'fixed' && section.id !== 'closing-words') {
                    // ×¢×“×›×•×Ÿ ×¡×¢×™×£ ×§×‘×•×¢
                    const fixedSection = document.querySelector(`[data-section-id="${section.id}"]`);
                    if (fixedSection) {
                        const textarea = fixedSection.querySelector('.editable-text');
                        if (textarea) {
                            textarea.value = section.content || '';
                        }
                    }
                } else if (section.type === 'contestants') {
                    // ×˜×¢×™× ×ª ×‘×—×™×¨×ª ××ª××•×“×“×™×
                    Object.keys(section.data).forEach(contestantId => {
                        const checkbox = document.getElementById(`check-${contestantId}`);
                        const textarea = document.querySelector(`[data-contestant="${contestantId}"]`);
                        if (checkbox) {
                            checkbox.checked = section.data[contestantId].selected;
                            toggleContestant(contestantId);
                        }
                        if (textarea) {
                            textarea.value = section.data[contestantId].text || '';
                        }
                    });
                } else if (section.type === 'round') {
                    // ×™×¦×™×¨×ª ×¡×™×‘×•×‘
                    addNewRound();
                    const rounds = document.querySelectorAll('.round');
                    const lastRound = rounds[rounds.length - 1];
                    
                    // ×¢×“×›×•×Ÿ ×©× ×•×˜×§×¡×˜ ×¤×ª×™×—×”
                    lastRound.querySelector('.round-header input').value = section.name || '';
                    lastRound.querySelector('.editable-text').value = section.intro || '';
                    
                    // ×”×•×¡×¤×ª ×©××œ×•×ª
                    const questionsList = lastRound.querySelector('.questions-list');
                    questionsList.innerHTML = ''; // × ×™×§×•×™
                    
                    section.questions.forEach(q => {
                        const newQuestion = createQuestionElement(q.videoData);
                        questionsList.appendChild(newQuestion);
                        
                        // ×¢×“×›×•×Ÿ ×”×©×“×•×ª
                        const inputs = newQuestion.querySelectorAll('input');
                        if (inputs[0]) inputs[0].value = q.question || '';
                        if (inputs[1]) inputs[1].value = q.answer || '';
                        if (inputs[2]) inputs[2].value = q.after || '';
                    });
                    
                    // ×¢×“×›×•×Ÿ dropzones
                    updateDropzones(questionsList);
                }
            });
            
            // ×¢×“×›×•×Ÿ ×“×‘×¨×™ ×¡×™×•×
            if (closingData) {
                const closingDiv = document.querySelector('[data-section-id="closing-words"]');
                if (closingDiv) {
                    closingDiv.querySelector('.editable-text').value = closingData.content;
                }
            }
            
            // ×”×¤×¢×œ×ª ×¡×¢×™×¤×™× ×§×‘×•×¢×™× (×—×•×¥ ××“×‘×¨×™ ×¡×™×•×)
            document.querySelectorAll('.script-section.fixed-section').forEach(section => {
                if (section.dataset.sectionId !== 'closing-words') {
                    section.classList.add('active');
                }
            });
            // ×¢×“×›×•×Ÿ ×¨×©×™××ª ×”×¡×¨×˜×•× ×™× ×‘×©×™××•×©
            updateUsedVideos();
        }
        
        // ×¤×•× ×§×¦×™×•×ª Drag & Drop ××©×•×¤×¨×•×ª
        function allowDrop(ev) {
            ev.preventDefault();
            if (ev.currentTarget.classList.contains('question-dropzone')) {
                ev.currentTarget.classList.add('drag-over');
            }
        }
        
        function dragLeave(ev) {
            if (ev.currentTarget.classList.contains('question-dropzone')) {
                ev.currentTarget.classList.remove('drag-over');
            }
        }
        
        function drag(ev) {
            const videoData = {
                firebaseId: ev.target.dataset.firebaseId.toString(),
                number: ev.target.dataset.number,
                category: ev.target.dataset.category,
                title: ev.target.dataset.title,
                description: ev.target.dataset.description,
                question: ev.target.dataset.question,
                approvalStatus: ev.target.dataset.approvalStatus
            };
            ev.dataTransfer.setData("videoData", JSON.stringify(videoData));
            ev.dataTransfer.effectAllowed = 'copy';
            ev.target.classList.add('dragging');
            
            // ×”×•×¡×¤×ª ××—×œ×§×” ×œ×’×•×£ ×”××¡××š
            document.body.classList.add('dragging');
        }
        
        function dragEnd(ev) {
            ev.target.classList.remove('dragging');
            
            // ×”×¡×¨×ª ××—×œ×§×” ××’×•×£ ×”××¡××š
            document.body.classList.remove('dragging');
            
            // ×”×¡×ª×¨×ª dropzones
            document.querySelectorAll('.question-dropzone').forEach(zone => {
                zone.classList.remove('drag-over');
            });
            
            // × ×™×§×•×™ ×›×œ×œ×™ ×©×œ ×›×œ ×”××¦×‘×™×
            cleanupDragStates();
        }
        
        // ×¤×•× ×§×¦×™×” ×œ× ×™×§×•×™ ×›×œ ××¦×‘×™ ×”×’×¨×™×¨×”
        function cleanupDragStates() {
            // ×”×¡×¨×ª ×›×œ ××—×œ×§×•×ª dragging
            document.querySelectorAll('.dragging').forEach(el => {
                el.classList.remove('dragging');
            });
            
            // ×”×¡×¨×ª drag-over ××›×œ ×”××œ×× ×˜×™×
            document.querySelectorAll('.drag-over').forEach(el => {
                el.classList.remove('drag-over');
            });
            
            // ×”×¡×¨×ª drag-preview
            document.querySelectorAll('.drag-preview').forEach(el => {
                el.classList.remove('drag-preview');
            });
            
            // ×•×™×“×•× ×©×”-body × ×§×™
            document.body.classList.remove('dragging');
            
            // × ×™×§×•×™ ×¡×•×¤×™ ××—×¨×™ 100ms ×œ××§×¨×” ×©××©×”×• × ×ª×§×¢
            setTimeout(() => {
                document.body.classList.remove('dragging');
                document.querySelectorAll('.dragging, .drag-over, .drag-preview').forEach(el => {
                    el.classList.remove('dragging', 'drag-over', 'drag-preview');
                });
            }, 100);
        }
        
        // ×’×¨×™×¨×ª ×©××œ×•×ª ×§×™×™××•×ª
        function dragQuestion(ev) {
            ev.dataTransfer.effectAllowed = 'move';
            ev.dataTransfer.setData('questionMove', 'true');
            ev.target.classList.add('dragging');
            
            // ×”×•×¡×¤×ª ××—×œ×§×” ×œ×’×•×£ ×”××¡××š
            document.body.classList.add('dragging');
            
            // ×¢×“×›×•×Ÿ dropzones
            const questionsList = ev.target.parentElement;
            updateDropzones(questionsList);
        }
        
        function dropQuestion(ev) {
            ev.preventDefault();
            const dropzone = ev.currentTarget;
            dropzone.classList.remove('drag-over');
            
            const isQuestionMove = ev.dataTransfer.getData('questionMove');
            const videoData = ev.dataTransfer.getData('videoData');
            
            if (isQuestionMove) {
                // ×”×¢×‘×¨×ª ×©××œ×” ×§×™×™××ª
                const draggingItem = document.querySelector('.question-item.dragging');
                if (draggingItem && dropzone.classList.contains('question-dropzone')) {
                    dropzone.parentNode.insertBefore(draggingItem, dropzone);
                    draggingItem.classList.remove('dragging');
                }
            } else if (videoData) {
                // ×”×•×¡×¤×ª ×¡×¨×˜×•×Ÿ ×—×“×©
                const data = JSON.parse(videoData);
                
                // ×‘×“×™×§×” ×× ×”×¡×¨×˜×•×Ÿ ×›×‘×¨ ×§×™×™×
                if (isVideoAlreadyUsed(data.firebaseId.toString())) {
                    showNotification('âš ï¸ ×¡×¨×˜×•×Ÿ ×–×” ×›×‘×¨ × ××¦× ×‘×ª×¡×¨×™×˜!', 'warning');
                    cleanupDragStates(); // × ×™×§×•×™ ××¦×‘×™ ×’×¨×™×¨×”
                    return;
                }
                
                const newQuestion = createQuestionElement(data);
                dropzone.parentNode.insertBefore(newQuestion, dropzone);
                
                // ×”×•×¡×¤×” ×œ×¨×©×™××ª ×”×¡×¨×˜×•× ×™× ×‘×©×™××•×©
                updateUsedVideos();
            }
            
            // ×¢×“×›×•×Ÿ dropzones
            const questionsList = dropzone.parentNode;
            updateDropzones(questionsList);
            
            // ×¢×“×›×•×Ÿ ××¡×¤×•×¨
            updateAllNumbering();
            
            // × ×™×§×•×™ ×›×œ×œ×™ ×©×œ ××¦×‘×™ ×’×¨×™×¨×”
            cleanupDragStates();
        }
        
        // ×™×¦×™×¨×ª ××œ×× ×˜ ×©××œ×” ×¢× ×× ×™××¦×™×”
        function createQuestionElement(data) {
            const questionItem = document.createElement('div');
            questionItem.className = 'question-item';
            questionItem.draggable = true;
            questionItem.ondragstart = dragQuestion;
            questionItem.ondragend = () => {
                questionItem.classList.remove('dragging');
                document.body.classList.remove('dragging');
                cleanupDragStates(); // × ×™×§×•×™ ×›×œ×œ×™
            };
            
            // ×”×•×¡×¤×ª ××™×¨×•×¢×™× ×œ×ª×¦×•×’×” ××§×“×™××” ×‘×–××Ÿ ×¨×™×—×•×£
            questionItem.ondragover = (e) => {
                e.preventDefault();
                const draggingItem = document.querySelector('.question-item.dragging');
                if (draggingItem && draggingItem !== questionItem) {
                    questionItem.classList.add('drag-preview');
                }
            };
            
            questionItem.ondragleave = () => {
                questionItem.classList.remove('drag-preview');
            };
            
            questionItem.ondrop = (e) => {
                e.preventDefault();
                questionItem.classList.remove('drag-preview');
            };
            
            const approvalStatus = data.approvalStatus || 'pending';
            const approvalText = {
                'approved': '×××•×©×¨',
                'not-approved': '×œ× ×××•×©×¨', 
                'pending': '×‘×˜×™×¤×•×œ'
            }[approvalStatus];
            
            const approvalClass = {
                'approved': 'style="background: #d4edda; color: #155724;"',
                'not-approved': 'style="background: #f8d7da; color: #721c24;"',
                'pending': 'style="background: #fff3cd; color: #856404;"'
            }[approvalStatus];
            
            questionItem.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div style="flex: 1;">
                        <strong>${data.title}</strong>
                        <span class="question-number">${data.number || '×œ×œ× ××¡×¤×¨'}</span>
                        <span ${approvalClass} style="padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: bold; margin-left: 5px;">${approvalText}</span>
                        <br>
                        <small>×§×˜×’×•×¨×™×”: ${data.category}</small>
                        ${data.description ? `<br><small>×ª×™××•×¨: ${data.description}</small>` : ''}
                        <div style="margin-top: 8px;">
                            <label style="font-weight: bold;">×©××œ×”:</label>
                            <input type="text" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;" 
                                   value="${data.question || ''}" placeholder="×”×›× ×¡ ×©××œ×”...">
                        </div>
                        <div style="margin-top: 8px;">
                            <label style="font-weight: bold;">×ª×©×•×‘×”:</label>
                            <input type="text" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;" 
                                   placeholder="×”×›× ×¡ ×ª×™××•×¨ ×ª×©×•×‘×”...">
                        </div>
                        <div style="margin-top: 8px;">
                            <label style="font-weight: bold;">××¤×˜×¨ ×¤×× ×¥':</label>
                            <input type="text" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;" 
                                   placeholder="×”×›× ×¡ ××¤×˜×¨ ×¤×× ×¥'...">
                        </div>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="removeQuestion(this)">ğŸ—‘ï¸</button>
                </div>
            `;
            
            questionItem.dataset.videoData = JSON.stringify(data);
            
            return questionItem;
        }
        
        // ×¢×“×›×•×Ÿ dropzones
        function updateDropzones(questionsList) {
            // ×”×¡×¨ ××ª ×›×œ ×”-dropzones ×”×§×™×™××™×
            questionsList.querySelectorAll('.question-dropzone').forEach(zone => zone.remove());
            
            // ×”×•×¡×£ dropzone ×œ×¤× ×™ ×›×œ ×©××œ×”
            const questions = questionsList.querySelectorAll('.question-item');
            questions.forEach(question => {
                const dropzone = createDropzone();
                questionsList.insertBefore(dropzone, question);
            });
            
            // ×”×•×¡×£ dropzone ×‘×¡×•×£
            const finalDropzone = createDropzone();
            questionsList.appendChild(finalDropzone);
        }
        
        function createDropzone() {
            const dropzone = document.createElement('div');
            dropzone.className = 'question-dropzone';
            dropzone.innerHTML = '×’×¨×•×¨ ×¡×¨×˜×•×Ÿ ×œ×›××Ÿ';
            dropzone.ondrop = dropQuestion;
            dropzone.ondragover = allowDrop;
            dropzone.ondragleave = dragLeave;
            return dropzone;
        }
        
        // ×’×¨×™×¨×ª ×¡×™×‘×•×‘×™× ××©×•×¤×¨×ª
        function dragRound(ev) {
            ev.dataTransfer.effectAllowed = 'move';
            ev.dataTransfer.setData('roundMove', 'true');
            ev.target.closest('.round').classList.add('dragging');
        }
        
        function dragOverRound(ev) {
            ev.preventDefault();
            const draggingRound = document.querySelector('.round.dragging');
            const currentRound = ev.target.closest('.round');
            if (draggingRound && currentRound && currentRound !== draggingRound) {
                currentRound.classList.add('drag-over');
            }
        }
        
        function dragLeaveRound(ev) {
            const currentRound = ev.target.closest('.round');
            if (currentRound) {
                currentRound.classList.remove('drag-over');
            }
        }
        
        function dropRound(ev) {
            ev.preventDefault();
            const currentRound = ev.target.closest('.round');
            if (currentRound) {
                currentRound.classList.remove('drag-over');
            }
            
            const isRoundMove = ev.dataTransfer.getData('roundMove');
            if (isRoundMove) {
                const draggingRound = document.querySelector('.round.dragging');
                if (draggingRound && currentRound && currentRound !== draggingRound) {
                    const container = document.getElementById('scriptContainer');
                    const allRounds = [...container.querySelectorAll('.round')];
                    const dragIndex = allRounds.indexOf(draggingRound);
                    const dropIndex = allRounds.indexOf(currentRound);
                    
                    if (dragIndex < dropIndex) {
                        container.insertBefore(draggingRound, currentRound.nextSibling);
                    } else {
                        container.insertBefore(draggingRound, currentRound);
                    }
                }
                if (draggingRound) {
                    draggingRound.classList.remove('dragging');
                }
                
                // ×¢×“×›×•×Ÿ ××¡×¤×•×¨
                updateAllNumbering();
            }
        }
        
        // ×¤×•× ×§×¦×™×” ×œ×¤×ª×™×—×”/×¡×’×™×¨×” ×©×œ ×¡×¢×™×£ ××ª×§×¤×œ
        function toggleCollapsible(sectionId) {
            const section = document.getElementById(sectionId);
            section.classList.toggle('collapsed');
        }
        
        // ×™×¦×™×¨×ª ×¡×¢×™×£ ×‘×—×™×¨×ª ××ª××•×“×“×™×
        function createContestantsSelection() {
            let html = '<div class="contestants-selection">';
            html += '<h4>×‘×—×¨ ××ª ×”××ª××•×“×“×™× ×©×™×©×ª×ª×¤×• ×‘×ª×•×›× ×™×ª:</h4>';
            
            contestants.forEach(contestant => {
                html += `
                    <div class="contestant-item" id="contestant-${contestant.id}">
                        <div class="contestant-checkbox">
                            <input type="checkbox" id="check-${contestant.id}" onchange="toggleContestant('${contestant.id}')">
                            <label for="check-${contestant.id}">${contestant.name}</label>
                        </div>
                        <div class="contestant-text">
                            <textarea placeholder="××” ${contestant.name} ××¡×¤×¨/×ª ×‘×¤×ª×™×—×”..." data-contestant="${contestant.id}"></textarea>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            return html;
        }
        
        // ×”×—×œ×¤×ª ××¦×‘ ××ª××•×“×“
        function toggleContestant(contestantId) {
            const item = document.getElementById(`contestant-${contestantId}`);
            const checkbox = document.getElementById(`check-${contestantId}`);
            
            if (checkbox.checked) {
                item.classList.add('selected');
            } else {
                item.classList.remove('selected');
            }
        }
        
        // ×™×¦×™×¨×ª ××‘× ×” ×”×ª×¡×¨×™×˜
        function initializeScript() {
            const openingContent = document.getElementById('openingContent');
            openingContent.innerHTML = '';
            
            // ×™×¦×™×¨×ª ×›×œ ×”×¡×¢×™×¤×™× ×”×§×‘×•×¢×™× ×‘×—×œ×§ ×”×¤×ª×™×—×”
            templateSections.forEach((section, index) => {
                if (section.id === 'closing-words') return; // ×“×‘×¨×™ ×”×¡×™×•× ×™×˜×•×¤×œ×• ×‘× ×¤×¨×“
                
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'script-section fixed-section';
                sectionDiv.dataset.sectionId = section.id;
                sectionDiv.dataset.sectionNumber = section.number;
                
                if (section.type === 'contestants') {
                    // ×¡×¢×™×£ ××™×•×—×“ ×œ×‘×—×™×¨×ª ××ª××•×“×“×™×
                    sectionDiv.innerHTML = `
                        <div class="section-header" onclick="toggleSection(this)">
                            <h4><span class="auto-number">${section.number}</span>. ${section.title}</h4>
                            <span>â–¼</span>
                        </div>
                        <div class="section-content">
                            ${createContestantsSelection()}
                        </div>
                    `;
                } else {
                    sectionDiv.innerHTML = `
                        <div class="section-header" onclick="toggleSection(this)">
                            <h4><span class="auto-number">${section.number}</span>. ${section.title}</h4>
                            <span>â–¼</span>
                        </div>
                        <div class="section-content">
                            <textarea class="editable-text" placeholder="×”×›× ×¡ ×˜×§×¡×˜...">${section.content}</textarea>
                        </div>
                    `;
                }
                
                openingContent.appendChild(sectionDiv);
            });
            
            // ×”×•×¡×¤×ª ×“×‘×¨×™ ×¡×™×•× ××—×¨×™ ××–×•×¨ ×”×•×¡×¤×ª ×”×¡×™×‘×•×‘
            const addRoundArea = document.querySelector('.add-round-area');
            const closingDiv = document.createElement('div');
            closingDiv.className = 'script-section fixed-section';
            closingDiv.dataset.sectionId = 'closing-words';
            closingDiv.innerHTML = `
                <div class="section-header" onclick="toggleSection(this)">
                    <h4>×“×‘×¨×™ ×¡×™×•×</h4>
                    <span>â–¼</span>
                </div>
                <div class="section-content">
                    <textarea class="editable-text" placeholder="×”×›× ×¡ ×“×‘×¨×™ ×¡×™×•×...">${templateSections.find(s => s.id === 'closing-words').content}</textarea>
                </div>
            `;
            addRoundArea.parentNode.insertBefore(closingDiv, addRoundArea.nextSibling);
            
            // ×¢×“×›×•×Ÿ ××•× ×” ×”×¡×¢×™×¤×™×
            sectionCounter = templateSections.length;
        }
        
        // ×”×—×œ×¤×ª ××¦×‘ ×¡×¢×™×£ (×¤×ª×•×—/×¡×’×•×¨)
        function toggleSection(header) {
            const section = header.parentElement;
            section.classList.toggle('active');
            const arrow = header.querySelector('span:last-child');
            arrow.textContent = section.classList.contains('active') ? 'â–²' : 'â–¼';
        }
        
        // ×”×—×œ×¤×ª ××¦×‘ ×¡×™×‘×•×‘
        function toggleRound(header) {
            if (event.target === header || event.target.tagName === 'H4') {
                const round = header.parentElement;
                round.classList.toggle('active');
                
                // × ×™×§×•×™ ××¦×‘×™ ×’×¨×™×¨×” ×›×©×¤×•×ª×—×™×/×¡×•×’×¨×™× ×¡×™×‘×•×‘
                cleanupDragStates();
            }
        }
        
        // ×”×•×¡×¤×ª ×¡×™×‘×•×‘ ×—×“×©
        function addNewRound() {
            roundCounter++;
            const container = document.getElementById('scriptContainer');
            
            const newRound = document.createElement('div');
            newRound.className = 'round';
            newRound.dataset.roundId = roundCounter;
            newRound.dataset.sectionNumber = sectionCounter;
            
            newRound.innerHTML = `
                <div class="round-header" onclick="toggleRound(this)" draggable="true" ondragstart="dragRound(event)" ondragover="dragOverRound(event)" ondragleave="dragLeaveRound(event)" ondrop="dropRound(event)">
                    <h4><span class="round-number">×¡×™×‘×•×‘ ${roundCounter}</span> - <input type="text" placeholder="×”×›× ×¡ ×©× ×¡×™×‘×•×‘" onclick="event.stopPropagation()" style="background: none; border: none; color: white; font-weight: bold;"></h4>
                    <button class="btn btn-danger btn-sm" onclick="removeRound(this, event)">ğŸ—‘ï¸</button>
                </div>
                <div class="round-content">
                    <textarea class="editable-text" style="margin-bottom: 10px;">×‘×¡×™×‘×•×‘ ×”×‘× [×”×›× ×¡ ×ª×™××•×¨ ×”×¡×™×‘×•×‘]
×™×“ ×¢×œ ×”×‘××–×¨. ××ª×—×™×œ×™×.</textarea>
                    <div class="questions-list">
                        <div class="question-dropzone" ondrop="dropQuestion(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                            ×’×¨×•×¨ ×¡×¨×˜×•×Ÿ ×œ×›××Ÿ
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(newRound);
            
            // ×¢×“×›×•×Ÿ ××¡×¤×•×¨
            updateAllNumbering();
            
            // × ×™×§×•×™ ××¦×‘×™ ×’×¨×™×¨×”
            cleanupDragStates();
            
            showNotification('âœ… ×¡×™×‘×•×‘ ×—×“×© × ×•×¡×£!');
        }
        
        function removeRound(btn, event) {
            event.stopPropagation();
            if (confirm('×”×× ×œ××—×•×§ ××ª ×”×¡×™×‘×•×‘?')) {
                btn.closest('.round').remove();
                updateRoundNumbers();
                updateAllNumbering();
                
                // ×¢×“×›×•×Ÿ ×¨×©×™××ª ×”×¡×¨×˜×•× ×™× ×‘×©×™××•×©
                updateUsedVideos();
                
                showNotification('âœ… ×¡×™×‘×•×‘ × ××—×§!');
            }
        }
        
        function removeQuestion(btn) {
            if (confirm('×”×× ×œ××—×•×§ ××ª ×”×©××œ×”?')) {
                const questionItem = btn.closest('.question-item');
                const questionsList = questionItem.parentElement;
                questionItem.remove();
                
                updateDropzones(questionsList);
                updateAllNumbering();
                
                // ×¢×“×›×•×Ÿ ×¨×©×™××ª ×”×¡×¨×˜×•× ×™× ×‘×©×™××•×©
                updateUsedVideos();
            }
        }
        
        // ×‘×“×™×§×” ×× ×¡×¨×˜×•×Ÿ ×›×‘×¨ ×‘×©×™××•×©
        function isVideoAlreadyUsed(firebaseId) {
            const allQuestions = document.querySelectorAll('.question-item');
            for (let question of allQuestions) {
                if (question.dataset.videoData) {
                    const data = JSON.parse(question.dataset.videoData);
                    if (data.firebaseId === firebaseId.toString()) {
                        return true;
                    }
                }
            }
            return false;
        }
        
        // ×¢×“×›×•×Ÿ ×¨×©×™××ª ×”×¡×¨×˜×•× ×™× ×‘×©×™××•×©
        function updateUsedVideos() {
            usedVideos.clear();
            const allQuestions = document.querySelectorAll('.question-item');
            allQuestions.forEach(question => {
                if (question.dataset.videoData) {
                    const data = JSON.parse(question.dataset.videoData);
                    usedVideos.add(data.firebaseId.toString());
                }
            });
            
            // ×¢×“×›×•×Ÿ ×”×ª×¦×•×’×” ×©×œ ×”×¡×¨×˜×•× ×™× ×‘×××’×¨
            updateVideoCardsStatus();
        }
        
        // ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ×›×¨×˜×™×¡×™ ×”×¡×¨×˜×•× ×™×
        function updateVideoCardsStatus() {
            document.querySelectorAll('.video-card').forEach(card => {
                const firebaseId = card.dataset.firebaseId;
                if (usedVideos.has(firebaseId)) {
                    card.classList.add('used');
                } else {
                    card.classList.remove('used');
                }
            });
        }
        
        // ×¢×“×›×•×Ÿ ××¡×¤×•×¨ ×¡×™×‘×•×‘×™×
        function updateRoundNumbers() {
            const rounds = document.querySelectorAll('.round');
            rounds.forEach((round, index) => {
                const roundNumber = round.querySelector('.round-number');
                if (roundNumber) {
                    roundNumber.textContent = `×¡×™×‘×•×‘ ${index + 1}`;
                }
            });
            roundCounter = rounds.length;
        }
        
        // ×¢×“×›×•×Ÿ ××¡×¤×•×¨ ××•×˜×•××˜×™
        function updateAllNumbering() {
            let currentNumber = 1;
            
            // ×¢×‘×•×¨ ×¢×œ ×›×œ ×”×¡×¢×™×¤×™× ×”×§×‘×•×¢×™×
            document.querySelectorAll('#openingContent .script-section.fixed-section').forEach(section => {
                const numberSpan = section.querySelector('.auto-number');
                if (numberSpan) {
                    numberSpan.textContent = currentNumber;
                    section.dataset.sectionNumber = currentNumber;
                    currentNumber++;
                }
            });
            
            // ×¢×‘×•×¨ ×¢×œ ×›×œ ×”×¡×™×‘×•×‘×™×
            document.querySelectorAll('.round').forEach(round => {
                round.dataset.sectionNumber = currentNumber;
                currentNumber++;
            });
            
            sectionCounter = currentNumber;
            
            // ×¢×“×›×•×Ÿ ××¡×¤×¨×™ ×”×¡×™×‘×•×‘×™×
            updateRoundNumbers();
        }
        
        // ×˜×¢×™× ×ª ×¡×¨×˜×•× ×™× ×-Firebase
        async function loadVideosFromFirebase() {
            try {
                showNotification('ğŸ“¥ ×˜×•×¢×Ÿ ×¡×¨×˜×•× ×™× ××”×××’×¨...');
                
                const snapshot = await videosRef.once('value');
                const data = snapshot.val();
                
                if (data && data.data && Array.isArray(data.data)) {
                    videoDatabase = data.data.filter(video => video && !video.archived);
                    
                    console.log(`× ×˜×¢× ×• ${videoDatabase.length} ×¡×¨×˜×•× ×™× ×-Firebase`);
                    
                    // ×¢×“×›×•×Ÿ ×¤×™×œ×˜×¨×™×
                    updateFilters();
                    
                    // ×”×¦×’×ª ×”×¡×¨×˜×•× ×™×
                    displayVideos();
                    
                    showNotification(`âœ… × ×˜×¢× ×• ${videoDatabase.length} ×¡×¨×˜×•× ×™×!`);
                } else {
                    showNotification('âš ï¸ ×œ× × ××¦××• ×¡×¨×˜×•× ×™× ×‘×××’×¨');
                }
            } catch (error) {
                console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×¡×¨×˜×•× ×™×:', error);
                showNotification('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×¡×¨×˜×•× ×™×', 'error');
            }
        }
        
        // ×¨×¢× ×•×Ÿ ×¡×¨×˜×•× ×™×
        async function refreshVideos() {
            await loadVideosFromFirebase();
        }
        
        // ×¢×“×›×•×Ÿ ×¤×™×œ×˜×¨×™×
        function updateFilters() {
            // ×¢×“×›×•×Ÿ ×¤×™×œ×˜×¨ ×§×˜×’×•×¨×™×•×ª
            const categoryFilter = document.getElementById('categoryFilter');
            const categories = [...new Set(videoDatabase.map(v => v.category))].sort();
            
            categoryFilter.innerHTML = '<option value="">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>';
            categories.forEach(cat => {
                categoryFilter.innerHTML += `<option value="${cat}">${cat}</option>`;
            });
        }
        
        // ×”×¦×’×ª ×¡×¨×˜×•× ×™×
        function displayVideos() {
            const videoList = document.getElementById('videoList');
            const searchTerm = document.getElementById('searchVideos').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const programFilter = document.getElementById('programFilter').value;
            const approvalFilter = document.getElementById('approvalFilter').value;
            
            const filteredVideos = videoDatabase.filter((video, index) => {
                const matchesSearch = !searchTerm || 
                    video.title.toLowerCase().includes(searchTerm) ||
                    (video.description && video.description.toLowerCase().includes(searchTerm)) ||
                    (video.question && video.question.toLowerCase().includes(searchTerm));
                
                const matchesCategory = !categoryFilter || video.category === categoryFilter;
                
                const matchesProgram = !programFilter || 
                    (programFilter === 'unassigned' && (!video.program || video.program === 'unassigned')) ||
                    video.program === programFilter;
                
                const matchesApproval = !approvalFilter || video.approvalStatus === approvalFilter;
                
                return matchesSearch && matchesCategory && matchesProgram && matchesApproval;
            });
            
            videoList.innerHTML = '';
            
            if (filteredVideos.length === 0) {
                videoList.innerHTML = '<div class="loading">×œ× × ××¦××• ×¡×¨×˜×•× ×™×</div>';
                return;
            }
            
            filteredVideos.forEach((video, index) => {
                const realIndex = videoDatabase.indexOf(video);
                const card = document.createElement('div');
                const approvalStatus = video.approvalStatus || 'pending';
                const isUsed = usedVideos.has(realIndex.toString());
                card.className = `video-card ${approvalStatus === 'not-approved' ? 'not-approved' : approvalStatus === 'pending' ? 'pending' : ''} ${isUsed ? 'used' : ''}`;
                card.draggable = true;
                card.ondragstart = drag;
                card.ondragend = dragEnd;
                
                // ×©××™×¨×ª × ×ª×•× ×™× ×¢×œ ×”×›×¨×˜×™×¡
                card.dataset.firebaseId = realIndex.toString();
                card.dataset.number = video.number || '';
                card.dataset.category = video.category || '';
                card.dataset.title = video.title || '';
                card.dataset.description = video.description || '';
                card.dataset.question = video.question || '';
                card.dataset.approvalStatus = approvalStatus;
                
                const approvalText = {
                    'approved': '×××•×©×¨',
                    'not-approved': '×œ× ×××•×©×¨',
                    'pending': '×‘×˜×™×¤×•×œ'
                }[approvalStatus];
                
                card.innerHTML = `
                    <h5>${video.title}</h5>
                    <div>
                        <span class="category">${video.category}</span>
                        <span class="program">${video.program && video.program !== 'unassigned' ? `×¤×¨×§ ${video.program}` : '×œ× ×©×•×‘×¥'}</span>
                        <span class="approval-status ${approvalStatus}">${approvalText}</span>
                    </div>
                    ${video.description ? `<small style="color: #666; display: block; margin-top: 4px;">${video.description}</small>` : ''}
                `;
                
                videoList.appendChild(card);
            });
        }
        
        // ×¡×™× ×•×Ÿ ×¡×¨×˜×•× ×™×
        function filterVideos() {
            displayVideos();
        }
        
        // ×™×¦×™×¨×ª ×ª×¡×¨×™×˜
        function buildScript() {
            let script = `×ª×›× ×™×ª ${document.getElementById('programNumber').value || '[××¡×¤×¨]'} -- ${document.getElementById('programDate').value || '[×ª××¨×™×š]'}\n`;
            script += `×“×¨××¤×˜ ${document.getElementById('draftNumber').value || '[××¡×¤×¨]'} -- ×‘×¢×‘×•×“×” -- ×œ××¢×§×‘ ×“× ×”/×”×¤×§×”\n\n`;
            
            // ××™×¡×•×£ ×”××ª××•×“×“×™× ×”× ×‘×—×¨×™×
            const selectedContestants = [];
            contestants.forEach(contestant => {
                const checkbox = document.getElementById(`check-${contestant.id}`);
                if (checkbox && checkbox.checked) {
                    selectedContestants.push(contestant.name);
                }
            });
            
            script += `**×§××¡×˜: ${selectedContestants.join(', ')}**\n\n`;
            script += `---\n\n`;
            
            let questionNumber = 1;
            
            // ×¢×‘×•×¨ ×¢×œ ×¡×¢×™×¤×™ ×”×¤×ª×™×—×”
            document.querySelectorAll('#openingContent .script-section').forEach(section => {
                const title = section.querySelector('.section-header h4').textContent;
                const sectionId = section.dataset.sectionId;
                
                if (sectionId === 'contestants-selection') {
                    // ×˜×™×¤×•×œ ××™×•×—×“ ×‘××ª××•×“×“×™×
                    script += `## ${title}\n\n`;
                    
                    contestants.forEach(contestant => {
                        const checkbox = document.getElementById(`check-${contestant.id}`);
                        if (checkbox && checkbox.checked) {
                            const textarea = document.querySelector(`[data-contestant="${contestant.id}"]`);
                            const text = textarea ? textarea.value : '';
                            
                            script += `×©×œ×•× ×œ${contestant.name}!\n`;
                            script += `××” × ×©××¢? [${text || '×”×›× ×¡ ×›××Ÿ ××” ' + contestant.name + ' ××¡×¤×¨/×ª'}] (×›×¤×™×™×)\n\n`;
                        }
                    });
                    
                    // ×”×•×¡×¤×ª CG ×œ×•×’×• ××—×¨×™ ×”××ª××•×“×“×™×
                    script += `## CG ×œ×•×’×•\n\n`;
                } else {
                    const content = section.querySelector('.editable-text')?.value || '';
                    
                    script += `## ${title}\n`;
                    if (content.trim()) {
                        script += `${content}\n\n`;
                    } else {
                        script += `\n`;
                    }
                }
            });
            
            // ×¢×‘×•×¨ ×¢×œ ×”×¡×™×‘×•×‘×™×
            const rounds = document.querySelectorAll('.round');
            rounds.forEach((round, roundIndex) => {
                const roundNameInput = round.querySelector('.round-header input');
                const roundName = roundNameInput ? roundNameInput.value : '';
                const roundIntro = round.querySelector('.editable-text').value;
                const roundNum = parseInt(round.dataset.sectionNumber);
                
                // ×‘×ª×¡×¨×™×˜ ×™×•×¤×™×¢ "×¤×ª×™×—×ª ×¡×™×‘×•×‘" ×œ×œ× ××¡×¤×¨
                script += `## ${roundNum}. ×¤×ª×™×—×ª ×¡×™×‘×•×‘ - ${roundName || '[×”×›× ×¡ ×©× ×¡×™×‘×•×‘]'}\n`;
                if (roundIntro.trim()) {
                    script += `${roundIntro}\n\n`;
                }
                
                // ×©××œ×•×ª ×‘×¡×™×‘×•×‘
                const questions = round.querySelectorAll('.question-item:not(.question-dropzone)');
                questions.forEach((question, qIndex) => {
                    const videoData = question.dataset.videoData ? JSON.parse(question.dataset.videoData) : null;
                    if (!videoData) return;
                    
                    const titleElement = question.querySelector('strong');
                    const questionInput = question.querySelector('input[placeholder="×”×›× ×¡ ×©××œ×”..."]');
                    const answerInput = question.querySelector('input[placeholder="×”×›× ×¡ ×ª×™××•×¨ ×ª×©×•×‘×”..."]');
                    const afterInput = question.querySelector('input[placeholder="×”×›× ×¡ ××¤×˜×¨ ×¤×× ×¥\'..."]');
                    
                    const title = titleElement ? titleElement.textContent : '[×”×›× ×¡ ×ª×™××•×¨]';
                    const questionText = questionInput ? questionInput.value : '';
                    const answerText = answerInput ? answerInput.value : '';
                    const afterText = afterInput ? afterInput.value : '';
                    
                    const baseNumber = roundNum + 1 + (qIndex * 5);
                    
                    script += `### ${baseNumber}. VTR ×©××œ×” -- ${title}\n\n`;
                    
                    script += `### ${baseNumber + 1}. CG ×¤×¨×™×–\n`;
                    script += `**${questionText || '[×”×›× ×¡ ××ª × ×•×¡×— ×”×©××œ×”]'}**\n\n`;
                    script += `(×¢×•× ×™×)\n\n`;
                    script += `×•×”×ª×©×•×‘×” ×”×™×:\n\n`;
                    
                    script += `### ${baseNumber + 2}. VTR ×ª×©×•×‘×” -- ${answerText || '**[×”×›× ×¡ ×ª×™××•×¨ ×”×ª×©×•×‘×”]**'}\n\n`;
                    
                    script += `### ${baseNumber + 3}. CG ×¤×¨×™×–\n`;
                    script += `**${afterText || '[×”×›× ×¡ ××¤×˜×¨ ×¤×× ×¥\']'}**\n\n`;
                    
                    script += `### ${baseNumber + 4}. CG ×œ×•×’×•\n`;
                    script += `××ª/×” ×¦×“×§×ª -- 10 × ×§×•×“×•×ª!\n\n`;
                    
                    if (qIndex < questions.length - 1) {
                        script += `×××©×™×›×™×:\n\n`;
                    }
                });
                
                // ×¡×•×£ ×¡×™×‘×•×‘
                const endNumber = roundNum + 1 + (questions.length * 5);
                script += `### ${endNumber}. ×©×•×˜ ×¡×•×£ ×¡×™×‘×•×‘\n`;
                script += `× ×’××¨ ×”×¡×™×‘×•×‘! ××” ×× ×™ ××’×™×“ ×œ×›×, ××ª× ×œ× ×‘×›×™×•×•×Ÿ.\n`;
                script += `××‘×œ ×–×” ××¦×‘ ×”× ×§×•×“×•×ª ×‘×¡×•×£ ×”×¡×™×‘×•×‘ ×”×–×” --\n\n`;
                script += `×¤×¨×™×™× ×©×œ ×›×•×œ× ××—×™×™×›×™× ×›×“×™ ×©××•×›×œ ×œ×”×¢×œ×•×ª ×¤×œ××— ×‘×¤×•×¡×˜\n\n`;
                script += `---\n\n`;
            });
            
            // ×¡×™×›×•× × ×§×•×“×•×ª
            script += `## ×¡×™×›×•× × ×§×•×“×•×ª ×¡×•×¤×™\n\n`;
            script += `×¡×™×›×•× × ×§×•×“×•×ª: - ×œ×¦×œ× ×©×•×˜×™× ×¤×ª×•×—×™× ×©×¢×œ×™×”× ×©×œ×•× ×™×•×›×œ ×œ×•××¨ ××™ ×–×›×”\n\n`;
            script += `×œ× ×œ×”×××™×Ÿ, ××‘×œ ×–××ª ×”×™×™×ª×” ×”×©××œ×” ×”××—×¨×•× ×”! ××” ×©××•××¨ ×©×–×” ×”×–××Ÿ ×œ×¡×›× ××ª ×”××™×¨×•×¢, ×‘×•××• × ×¨××” ××ª ×”×˜×‘×œ×” ×¢×œ ×”××¡×š:\n\n`;
            script += `(×‘×”××©×š - ×œ×”×§×œ×™×˜ ×‘× ×¤×¨×“ ××ª ×©×œ×•× ××•××¨ ××ª ×”×–×•×›×”/××¡×™×“ ×‘×•×¨×¡×™×•×ª)\n\n`;
            
            // ×“×‘×¨×™ ×¡×™×•×
            const closingSection = document.querySelector('[data-section-id="closing-words"]');
            const closingText = closingSection ? closingSection.querySelector('.editable-text').value : '';
            
            script += `## ×“×‘×¨×™ ×¡×™×•×\n\n`;
            script += closingText || '×–×”×• ×œ×”×™×•×. ×œ×™×œ×” ×˜×•×‘.';
            
            return script;
        }
        
        // ×ª×¦×•×’×” ××§×“×™××”
        function previewScript() {
            const script = buildScript();
            document.getElementById('scriptPreview').textContent = script;
            document.getElementById('previewModal').style.display = 'flex';
        }
        
        // ×™×™×¦×•× ×ª×¡×¨×™×˜
        function exportScript() {
            const script = buildScript();
            const blob = new Blob([script], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `×ª×›× ×™×ª_${document.getElementById('programNumber').value || 'X'}_×“×¨××¤×˜_${document.getElementById('draftNumber').value || 'X'}.txt`;
            link.click();
            URL.revokeObjectURL(url);
            showNotification('âœ… ×”×ª×¡×¨×™×˜ ×™×•×¦× ×‘×”×¦×œ×—×”!');
        }
        
        // ×™×™×¦×•× ×œ×•×•×¨×“
        function exportToWord() {
            const programNum = document.getElementById('programNumber').value || '[××¡×¤×¨]';
            const programDate = document.getElementById('programDate').value || '[×ª××¨×™×š]';
            const draftNum = document.getElementById('draftNumber').value || '[××¡×¤×¨]';
            
            let wordContent = `
            <!DOCTYPE html>
            <html xmlns:o="urn:schemas-microsoft-com:office:office" 
                  xmlns:w="urn:schemas-microsoft-com:office:word" 
                  xmlns="http://www.w3.org/TR/REC-html40">
            <head>
                <meta charset="UTF-8">
                <!--[if gte mso 9]>
                <xml>
                <w:WordDocument>
                <w:View>Print</w:View>
                <w:Zoom>100</w:Zoom>
                <w:DoNotOptimizeForBrowser/>
                </w:WordDocument>
                </xml>
                <![endif]-->
                <style>
                    @page {
                        margin: 2cm;
                        size: A4;
                    }
                    body {
                        font-family: 'Arial', sans-serif;
                        direction: rtl;
                        text-align: right;
                        line-height: 1.6;
                        color: #333;
                    }
                    h1 {
                        font-size: 20pt;
                        color: #2c3e50;
                        text-align: center;
                        margin-bottom: 10pt;
                        border-bottom: 3pt solid #667eea;
                        padding-bottom: 10pt;
                    }
                    h2 {
                        font-size: 16pt;
                        color: #34495e;
                        margin-top: 20pt;
                        margin-bottom: 10pt;
                        background: #e3f2fd;
                        padding: 8pt;
                        border-right: 4pt solid #667eea;
                    }
                    h3 {
                        font-size: 12pt;
                        color: #2c3e50;
                        margin-top: 15pt;
                        margin-bottom: 8pt;
                    }
                    p {
                        margin-bottom: 8pt;
                    }
                    .header-info {
                        text-align: center;
                        font-size: 12pt;
                        color: #666;
                        margin-bottom: 20pt;
                    }
                    .cast {
                        background: #f8f9fa;
                        padding: 10pt;
                        border-radius: 5pt;
                        margin-bottom: 20pt;
                        text-align: center;
                        font-weight: bold;
                    }
                    hr {
                        border: none;
                        border-top: 2pt solid #ecf0f1;
                        margin: 20pt 0;
                    }
                </style>
            </head>
            <body>`;
            
            // ×‘× ×™×™×ª ×”×ª×•×›×Ÿ
            const scriptText = buildScript();
            const lines = scriptText.split('\n');
            
            lines.forEach(line => {
                if (line.startsWith('## ')) {
                    wordContent += `<h2>${line.substring(3)}</h2>`;
                } else if (line.startsWith('### ')) {
                    wordContent += `<h3>${line.substring(4)}</h3>`;
                } else if (line.startsWith('**') && line.endsWith('**')) {
                    wordContent += `<p><strong>${line.substring(2, line.length - 2)}</strong></p>`;
                } else if (line === '---') {
                    wordContent += '<hr>';
                } else if (line.trim()) {
                    wordContent += `<p>${line}</p>`;
                }
            });
            
            wordContent += `
            </body>
            </html>`;
            
            // ×™×¦×™×¨×ª ×§×•×‘×¥ ×•×•×¨×“
            const blob = new Blob([wordContent], {
                type: 'application/msword;charset=utf-8'
            });
            
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `×ª×›× ×™×ª_${programNum}_×“×¨××¤×˜_${draftNum}.doc`;
            link.click();
            URL.revokeObjectURL(url);
            
            showNotification('âœ… ×”×ª×¡×¨×™×˜ ×™×•×¦× ×œ×•×•×¨×“ ×‘×”×¦×œ×—×”!');
        }
        
        // ×©××™×¨×ª ×¤×¨×•×™×§×˜
        function saveProject() {
            const project = buildProjectData();
            
            const blob = new Blob([JSON.stringify(project, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `×¤×¨×•×™×§×˜_×ª×›× ×™×ª_${project.programNumber || 'X'}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showNotification('âœ… ×”×¤×¨×•×™×§×˜ × ×©××¨!');
        }
        
        // ×˜×¢×™× ×ª ×¤×¨×•×™×§×˜
        function loadProject() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const project = JSON.parse(e.target.result);
                        loadProjectData(project);
                        showNotification('âœ… ×”×¤×¨×•×™×§×˜ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”!');
                    } catch (error) {
                        showNotification('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¤×¨×•×™×§×˜', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        // ×”×¦×’×ª ×”×•×“×¢×•×ª
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.background = type === 'error' ? '#dc3545' : type === 'warning' ? '#ff9800' : '#28a745';
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // ×¡×’×™×¨×ª ××•×“××œ
        function closeModal() {
            document.getElementById('previewModal').style.display = 'none';
        }
        
        // ×”××–× ×” ×œ×©×™× ×•×™×™× ×‘×–××Ÿ ×××ª
        function setupRealtimeListener() {
            videosRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data && data.data && Array.isArray(data.data)) {
                    const newVideoData = data.data.filter(video => video && !video.archived);
                    
                    // ×‘×“×™×§×” ×× ×”× ×ª×•× ×™× ×”×©×ª× ×•
                    if (JSON.stringify(newVideoData) !== JSON.stringify(videoDatabase)) {
                        console.log('×–×•×”×” ×¢×“×›×•×Ÿ ×‘×××’×¨ ×”×¡×¨×˜×•× ×™×!');
                        
                        videoDatabase = newVideoData;
                        
                        // ×¢×“×›×•×Ÿ ×”×××©×§
                        updateFilters();
                        displayVideos();
                        
                        // ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ×”×¡×¨×˜×•× ×™×
                        updateVideoCardsStatus();
                        
                        showNotification('ğŸ”„ ×”×××’×¨ ×¢×•×“×›×Ÿ!');
                    }
                }
            });
        }
        
        // ××ª×—×•×œ ×”××¤×œ×™×§×¦×™×”
        async function initApp() {
            // ×™×¦×™×¨×ª ××‘× ×” ×”×ª×¡×¨×™×˜
            initializeScript();
            
            // ×˜×¢×™× ×ª ×¡×¨×˜×•× ×™× ×-Firebase
            await loadVideosFromFirebase();
            
            // ×¢×“×›×•×Ÿ ×¨×©×™××ª ×”×¡×¨×˜×•× ×™× ×‘×©×™××•×©
            updateUsedVideos();
            
            // ×”×¤×¢×œ×ª ×××–×™×Ÿ ×œ×¢×“×›×•× ×™×
            setupRealtimeListener();
            
            // ×”×¤×¢×œ×ª ×›×œ ×”×¡×¢×™×¤×™× ×”×§×‘×•×¢×™× ×‘×‘×¨×™×¨×ª ××—×“×œ (×—×•×¥ ××“×‘×¨×™ ×¡×™×•×)
            document.querySelectorAll('.script-section.fixed-section').forEach(section => {
                if (section.dataset.sectionId !== 'closing-words') {
                    section.classList.add('active');
                }
            });
            
            // ×”×•×¡×¤×ª ×××–×™× ×™× ×’×œ×•×‘×œ×™×™× ×œ× ×™×§×•×™ ××¦×‘×™ ×’×¨×™×¨×”
            document.addEventListener('dragend', cleanupDragStates);
            document.addEventListener('drop', cleanupDragStates);
            document.addEventListener('mouseup', cleanupDragStates);
        }
        
        // ×”×¤×¢×œ×ª ×”××¤×œ×™×§×¦×™×”
        initApp();
    </script>
</body>
</html>
